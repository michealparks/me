import{V as e,P as t,C as i,S as a,A as n,a as s,B as o,K as r,b as l,c as d,R as c,E as h,e as g,W as p,d as w,s as u,f as y,H as m,F as f,g as b,h as v,T as M,i as S,G as x,j as B,L as z,k as C,M as R,O as q,l as j,Q as L}from"./vendor.85e5a7c0.js";new e(0,1,0);const V=t,F={passive:!0};class O{constructor(e,t,M,S){this.clock=new i,this.scene=new a,this.listener=new n,this.width=0,this.height=0,this.dpi=0,this.init=async(e=!1)=>{const t=new s,[i,a]=e?[new OffscreenCanvas(64,64),new OffscreenCanvas(64,64)]:await new Promise((e=>t.load(e))),n=new o({height:480,intensity:1,kernelSize:r.VERY_LARGE}),g=new l(i,a,d.ULTRA);this.composer.addPass(new c(this.scene,this.camera)),this.composer.addPass(new h(this.camera,g,n))},this.update=()=>{const e=this.clock.getDelta(),t=this.gl.domElement;return g.update(),t.width===this.width&&t.height===this.height?this.composer.render(e):(this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.gl.setSize(this.width,this.height,!1),this.composer.setSize(this.width,this.height,!1)),e},this.setSize=(e,t)=>{this.width=e*this.dpi|0,this.height=t*this.dpi|0},this.add=e=>{},this.gl=new p({canvas:e,antialias:!0,depth:!1,stencil:!1,powerPreference:"high-performance"}),this.canvas=e,this.dpi=Math.min(S,2),this.setSize(t,M),this.gl.toneMapping=w,this.gl.toneMappingExposure=1,this.gl.outputEncoding=u,this.gl.physicallyCorrectLights=!0,this.gl.shadowMap.enabled=!0,this.gl.shadowMap.type=V,this.composer=new y(this.gl,{frameBufferType:m}),this.scene.fog=new f("black",10,20),this.camera=new b(30,t/M,.1,100),this.scene.add(this.camera),this.camera.add(this.listener),this.ambientLight=new v(11527155,1),this.scene.add(this.ambientLight)}}const A=new z,P=new M,D=new S,I=new x,T=new B;P.setPath("/assets/textures/"),D.setPath("/assets/mp3/"),I.setPath("/assets/glb/"),T.setPath("/assets/fonts/");const E=new Set,k=new Set,W=new Set,N=new Map,G=e=>{if(e.includes(".typeface.json"))return(async e=>{N.set(e,await T.loadAsync(e))})(e);switch(e.split(".").pop()){case"glb":return(async e=>{N.set(e,await I.loadAsync(e))})(e);case"png":case"jpg":return(async e=>{N.set(e,await P.loadAsync(e))})(e);case"mp3":return(async e=>{N.set(e,await D.loadAsync(e))})(e);case"json":return(async e=>{const t=await fetch("assets/json/"+e);N.set(e,await t.json())})(e)}},H=e=>{for(const t of e)E.add(t);return Y},Y={cache:N,manager:A,textureLoader:P,audioLoader:D,gltfLoader:I,get(e){return N.get(e)},queue(...e){return H(e),Y},queueMany:H,on(e,t){switch(e){case"load":return k.add(t)}},load(...e){e&&H(e);for(const t of E)W.add(G(t));return Promise.all(W).then((()=>{for(const e of k)e();return E.clear(),W.clear(),N.get(e[0])}))},loadOne:G},Q=new Map,U=(e,t)=>{if(!1!==Q.has(e))for(const i of Q.get(e))i(t)},X=new Set,K=new Map,_=new Map,J=new Map,Z=new Map,$=new Map,ee=new Map,te=new Map;let ie,ae,ne,se,oe,re,le,de,ce,he,ge,pe=0,we=0,ue=0,ye=0,me=0;const fe=(e,t)=>{const{id:i}=e;let a=!1;!1===_.has(i)&&_.set(i,{body:e,others:new Map});const n=_.get(i);return!1===n.others.has(t.id)&&(n.others.set(t.id,t),a=!0),!1===J.has(i)&&J.set(i,{body:e,others:new Map}),J.get(i).others.set(t.id,t),a},be=(e,t,i)=>{!1===e.has(t)&&e.set(t,[]),e.get(t).push(i)},ve=(e,t,i)=>{var a,n,s,o,r,l;const{transform:d}=e;let c;const h=((e,t,i,a)=>{switch(t){case 0:return de.setValue(i[7],i[8],i[9]),new re.btBoxShape(de);case 2:if(void 0===a)throw Error(e+": vertices is undefined");{const e=new re.btTriangleMesh,t=!0;for(let i=0,n=a.length;i<n;i+=9)de.setValue(a[i+0],a[i+1],a[i+2]),ce.setValue(a[i+3],a[i+4],a[i+5]),he.setValue(a[i+6],a[i+7],a[i+8]),e.addTriangle(de,ce,he,!0);return new re.btBvhTriangleMeshShape(e,t)}case 1:return new re.btSphereShape(i[7]);default:throw Error("Shape not specified.")}})(e.name,e.shape,d,e.triangles);h.setMargin(0),!0===t&&(c=new re.btVector3(0,0,0),h.calculateLocalInertia(null!=(a=e.mass)?a:0,c)),de.setValue(d[0],d[1],d[2]),ge.setValue(d[3],d[4],d[5],d[6]),le.setOrigin(de),le.setRotation(ge);const g=new re.btDefaultMotionState(le),p=new re.btRigidBodyConstructionInfo(null!=(n=e.mass)?n:0,g,h,c),w=new re.btRigidBody(p);return w.type=e.type,w.trigger=!1,w.id=e.id,w.name=e.name,w.linkedRigidbodyId=e.linkedRigidbodyId,w.setRestitution(null!=(s=e.restitution)?s:0),w.setFriction(null!=(o=e.friction)?o:0),w.setDamping(null!=(r=e.linearDamping)?r:0,null!=(l=e.angularDamping)?l:0),void 0!==i&&w.setCollisionFlags(w.getCollisionFlags()|i),re.destroy(p),!0===t&&re.destroy(c),K.set(w.id,w),w},Me=(e,t,i=!1,a=0)=>{var n;ne=K.get(e),ne.activate(),!0===i&&(de.setValue(0,0,0),ne.setLinearVelocity(de),de.setValue(0,0,0),ne.setAngularVelocity(de)),de.setValue(t[a+0],t[a+1],t[a+2]),ge.setValue(t[a+3],t[a+4],t[a+5],t[a+6]),le.setOrigin(de),le.setRotation(ge),ne.setWorldTransform(le),2===ne.type&&(null==(n=ne.getMotionState())||n.setWorldTransform(le))},Se={async init(){re=await globalThis.Ammo(),le=new re.btTransform,de=new re.btVector3,ce=new re.btVector3,he=new re.btVector3,ge=new re.btQuaternion;const e=new re.btDefaultCollisionConfiguration,t=new re.btCollisionDispatcher(e),i=new re.btDbvtBroadphase,a=new re.btSequentialImpulseConstraintSolver;ie=new re.btDiscreteDynamicsWorld(t,i,a,e),ie.setGravity(new re.btVector3(0,-9.8,0))},update(e){var t;for(ne of(pe=performance.now(),ue=(pe-we)/1e3,we=pe,ie.stepSimulation(ue,40,.016666666666666666),ye=0,X))!1!==ne.isActive()&&(ae=ne.getMotionState(),ae.getWorldTransform(le),se=le.getOrigin(),oe=le.getRotation(),me=7*ye,e[me+0]=se.x(),e[me+1]=se.y(),e[me+2]=se.z(),e[me+3]=oe.x(),e[me+4]=oe.y(),e[me+5]=oe.z(),e[me+6]=oe.w(),void 0!==ne.linkedRigidbodyId&&(null==(t=K.get(ne.linkedRigidbodyId))||t.setMotionState(ae)),ye+=1);const i=[];return(e=>{ee.clear(),Z.clear(),J.clear();const t=ie.getDispatcher(),i=t.getNumManifolds();for(ye=0;ye<i;ye++){const i=t.getManifoldByIndexInternal(ye);if(0===i.getNumContacts())continue;const a=re.castObject(i.getBody0(),re.btRigidBody),n=re.castObject(i.getBody1(),re.btRigidBody);let s=!1;const o=4==(4&a.getCollisionFlags()),r=4==(4&n.getCollisionFlags());o||r?(s=fe(a,n),s&&!1===r&&(be(ee,a.id,n.id),!a.enter||n.name!==a.entity&&"any"!==a.entity||e.push([a.enter,a.id,n.id])),s=fe(n,a),s&&!1===o&&(be(ee,n.id,a.id),!n.enter||a.name!==n.entity&&"any"!==n.entity||e.push([n.enter,n.id,a.id]))):(s=fe(a,n),s&&be(Z,a.id,n.id),s=fe(n,a),s&&be(Z,n.id,a.id))}})(i),(e=>{te.clear(),$.clear();for(const[t,i]of _){const a=J.get(t),{body:n,others:s}=i;for(const[t,i]of s)void 0!==a&&!1!==a.others.has(t)||(s.delete(t),!0===n.trigger?(be(te,n.id,i.id),!n.leave||i.name!==n.entity&&"any"!==n.entity||e.push([n.leave,n.id,i.id])):!1===i.trigger&&be($,n.id,i.id));0===s.size&&_.delete(t)}})(i),{transforms:e,globalEvents:i,triggerEnter:[...ee],collisionStart:[...Z],triggerLeave:[...te],collisionEnd:[...$]}},applyCentralImpulse(e,t){ne=K.get(e),de.setValue(t.x,t.y,t.z),ne.applyCentralImpulse(de),ne.activate()},applyCentralForce(e,t){ne=K.get(e),de.setValue(t.x,t.y,t.z),ne.applyCentralForce(de),ne.activate()},teleport:Me,teleportMany(e,t,i=!1){ye=0;for(const a of e)Me(a,t,i,ye),ye+=7},createRigidbodies(e){let t,i,a;for(const n of e)switch(n.type){case 0:a=!1,t=1,i=ve(n,a,t),ie.addRigidBody(i,2,65533);break;case 1:a=0!==(n.mass||0),t=void 0,i=ve(n,a,t),X.add(i),ie.addRigidBody(i,1,65535);break;case 2:a=!1,t=2,i=ve(n,a,t),i.setActivationState(4),ie.addRigidBody(i)}},setGravity(e){de.setValue(e.x,e.y,e.z),ie.setGravity(de)}},xe=new Map,Be=new Set;let ze=new Float32Array(700),Ce=0,Re=0;const qe={bodyMap:xe,dynamicBodies:Be,init(){return Se.init()},update(){const e=Se.update(ze);for(const[t,i]of e.collisionStart)U("collisionstart",{id:t,others:i});ze=e.transforms,Ce=0;for(const t of Be)Re=7*Ce,t.position.set(ze[Re+0],ze[Re+1],ze[Re+2]),t.quaternion.set(ze[Re+3],ze[Re+4],ze[Re+5],ze[Re+6]),t.updateMatrix(),Ce+=1},addRigidbodies(e,t){Ce=0;for(const i of e){switch(xe.set(i.id,i),i.matrixAutoUpdate=!1,t[Ce].type){case 1:Be.add(i)}Ce+=1}Se.createRigidbodies(t)},applyCentralImpulse:Se.applyCentralImpulse,applyCentralForce:Se.applyCentralForce,teleport:Se.teleport,teleportMany:Se.teleportMany,setGravity:Se.setGravity},je=(e,t)=>{const i=4*Math.random()-3,a=Math.random(),n=Math.random(),s=Math.random();return e.position.set(i,7,0),e.rotation.set(a,n,s),e.updateMatrix(),t[0]=i,t[1]=7,t[2]=0,t[3]=e.quaternion.x,t[4]=e.quaternion.y,t[5]=e.quaternion.z,t[6]=e.quaternion.w,t[7]=t[8]=t[9]=.25,t},Le=(e,t=300)=>{let i;return function(...a){clearTimeout(i),i=setTimeout((()=>e.apply(this,a)),t)}},Ve=new e,Fe=new C,Oe=()=>new Promise((e=>{"requestIdleCallback"in window?window.requestIdleCallback(e):e(void 0)})),Ae=e=>new Promise((t=>{setTimeout(t,e)})),Pe=e=>{e instanceof R&&(e.castShadow=!0,e.receiveShadow=!0)},De=e=>{const t=e.getObjectByName("BoundingBox");t?(Fe.setFromObject(t),t.visible=!1):Fe.setFromObject(e),Fe.getSize(Ve)},Ie=e=>{e.traverse(Pe)},Te=async e=>{await Oe();const t=new Float32Array(7);je(e,t),qe.teleport(e.id,t,!0),setTimeout(Te,12e3,e)};(async()=>{const t=document.querySelector("#canvas"),i=new O(t,innerWidth,innerHeight,devicePixelRatio),{scene:a,camera:n}=i;await Promise.all([i.init(),qe.init(),Y.load("name.glb")]),(async(e,t)=>{for((e=>{let t,i=e.length-1,a=0;for(;i>0;)a=Math.random()*(i+1)|0,t=e[i],e[i]=e[a],e[a]=t,i-=1})(e);e.length>0;){const{file:i,sel:a}=e.pop();await Oe(),await Y.load(i);const n=Y.get(i).scene,s=a?n.getObjectByName(a):n;Ie(s);const o=new Float32Array(10);je(s,o),De(s),o[7]=Ve.x/2,o[8]=Ve.y/2,o[9]=Ve.z/2,await Oe(),qe.addRigidbodies([s],[{id:s.id,name:s.name,type:1,shape:0,transform:o,mass:1,linearDamping:0,angularDamping:0,friction:.3,restitution:.9}]),await Oe(),t.add(s),Te(s),await Ae(2e3)}})([{file:"portrait.glb",sel:"Portrait"},{file:"switch.glb"},{file:"synth.glb"},{file:"plant.glb"},{file:"lego.glb",sel:"Lego1"},{file:"lego.glb",sel:"Lego2"},{file:"lego.glb",sel:"Lego3"},{file:"lego.glb",sel:"Lego4"},{file:"lego.glb",sel:"Lego5"}],a);const s=Y.get("name.glb").scene;a.add(s);const o=s.getObjectByName("Light").children[0];o.castShadow=!0,o.shadow.bias=-.001;const r=s.getObjectByName("Micheal"),l=s.getObjectByName("Title");r.receiveShadow=!0,l.receiveShadow=!0;const d=new e,c=new C,h=new Float32Array(10);h[0]=r.position.x,h[1]=r.position.y,h[2]=r.position.z,h[3]=r.quaternion.x,h[4]=r.quaternion.y,h[5]=r.quaternion.z,h[6]=r.quaternion.w;const g=s.getObjectByName("BoundingBox1");c.setFromObject(g),g.visible=!1,c.getSize(d),h[7]=d.x/2,h[8]=d.y/2,h[9]=d.z/2;const p=new Float32Array(10);p[0]=l.position.x,p[1]=l.position.y,p[2]=l.position.z,p[3]=l.quaternion.x,p[4]=l.quaternion.y,p[5]=l.quaternion.z,p[6]=l.quaternion.w;const w=s.getObjectByName("BoundingBox2");c.setFromObject(w),w.visible=!1,c.getSize(d),p[7]=d.x/2,p[8]=d.y/2,p[9]=d.z/2,qe.addRigidbodies([r,l],[{id:r.id,name:r.name,type:0,shape:0,transform:h,friction:.3,restitution:.5},{id:l.id,name:l.name,type:0,shape:0,transform:p,friction:.3,restitution:.5}]);{const e=s.getObjectByName("Camera");n.position.copy(e.position),n.quaternion.copy(e.quaternion.multiply(e.children[0].quaternion))}d.set(0,-2,0),qe.setGravity(d);let u=!1;const y=()=>{i.setSize(t.clientWidth,t.clientHeight),innerWidth<600&&!1===u?(n.getWorldDirection(d),d.multiplyScalar(-5),n.position.add(d),u=!0):innerWidth>=600&&!0===u&&(n.getWorldDirection(d),d.multiplyScalar(5),n.position.add(d),u=!1)},m=new q;a.add(m),m.attach(n);const f=new j,b=new L,v=()=>{i.update(),n.lookAt(r.position),b.z=2*f.x/Math.PI/5,b.x=2*f.y/Math.PI/5,m.rotation.set(b.x,0,b.z),qe.update(),requestAnimationFrame(v)};y(),window.addEventListener("resize",Le(y,400),F),window.addEventListener("mousemove",(e=>{f.x=+e.clientX/window.innerWidth*2-1,f.y=-e.clientY/window.innerHeight*2+1}),F),window.addEventListener("touchstart",(e=>{e.preventDefault()})),window.addEventListener("touchmove",(e=>{e.preventDefault(),f.x=+e.touches[0].clientX/window.innerWidth*2-1,f.y=-e.touches[0].clientY/window.innerHeight*2+1})),requestAnimationFrame(v)})();
