import{V as e,P as t,C as i,S as n,A as a,a as s,B as o,K as r,b as l,c as d,R as c,E as h,e as g,W as p,d as u,s as w,f as y,H as m,F as f,g as b,h as v,T as M,i as S,G as x,j as B,L as z,k as R,M as j,O as q,l as L,Q as V}from"./vendor.6ffa1b68.js";new e(0,1,0);const C=t,F={passive:!0};class A{constructor(e,t,M,S){this.clock=new i,this.scene=new n,this.listener=new a,this.width=0,this.height=0,this.dpi=0,this.init=async()=>{const e=new s,[t,i]=await new Promise((t=>e.load(t))),n=new o({height:480,intensity:1,kernelSize:r.VERY_LARGE}),a=new l(t,i,d.ULTRA);this.composer.addPass(new c(this.scene,this.camera)),this.composer.addPass(new h(this.camera,a,n))},this.update=()=>{const e=this.clock.getDelta(),t=this.gl.domElement;return g.update(),t.width===this.width&&t.height===this.height?this.composer.render(e):(this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.gl.setSize(this.width,this.height,!1),this.composer.setSize(this.width,this.height,!1)),e},this.setSize=(e,t)=>{this.width=e*this.dpi|0,this.height=t*this.dpi|0},this.add=e=>{},this.gl=new p({canvas:e,antialias:!1,depth:!1,stencil:!1,powerPreference:"high-performance"}),this.canvas=e,this.dpi=Math.min(S,2),this.setSize(t,M),this.gl.toneMapping=u,this.gl.toneMappingExposure=1,this.gl.outputEncoding=w,this.gl.physicallyCorrectLights=!0,this.gl.shadowMap.enabled=!0,this.gl.shadowMap.type=C,this.composer=new y(this.gl,{frameBufferType:m}),this.scene.fog=new f("black",10,20),this.camera=new b(30,t/M,.1,100),this.scene.add(this.camera),this.camera.add(this.listener),this.ambientLight=new v(11527155,1),this.scene.add(this.ambientLight)}}const O=new z,D=new M,P=new S,T=new x,E=new B;D.setPath("/assets/textures/"),P.setPath("/assets/mp3/"),T.setPath("/assets/glb/"),E.setPath("/assets/fonts/");const I=new Set,W=new Set,k=new Set,N=new Map,G=e=>{if(e.includes(".typeface.json"))return(async e=>{N.set(e,await E.loadAsync(e))})(e);switch(e.split(".").pop()){case"glb":return(async e=>{N.set(e,await T.loadAsync(e))})(e);case"png":case"jpg":return(async e=>{N.set(e,await D.loadAsync(e))})(e);case"mp3":return(async e=>{N.set(e,await P.loadAsync(e))})(e);case"json":return(async e=>{const t=await fetch("assets/json/"+e);N.set(e,await t.json())})(e)}},H=e=>{for(const t of e)I.add(t);return Y},Y={cache:N,manager:O,textureLoader:D,audioLoader:P,gltfLoader:T,get(e){return N.get(e)},queue(...e){return H(e),Y},queueMany:H,on(e,t){switch(e){case"load":return W.add(t)}},load(...e){e&&H(e);for(const t of I)k.add(G(t));return Promise.all(k).then((()=>{for(const e of W)e();return I.clear(),k.clear(),N.get(e[0])}))},loadOne:G},Q=new Map,U=(e,t)=>{if(!1!==Q.has(e))for(const i of Q.get(e))i(t)},X=new Set,K=new Map,_=new Map,J=new Map,Z=new Map,$=new Map,ee=new Map,te=new Map;let ie,ne,ae,se,oe,re,le,de,ce,he,ge,pe=0,ue=0,we=0,ye=0,me=0;const fe=(e,t)=>{const{id:i}=e;let n=!1;!1===_.has(i)&&_.set(i,{body:e,others:new Map});const a=_.get(i);return!1===a.others.has(t.id)&&(a.others.set(t.id,t),n=!0),!1===J.has(i)&&J.set(i,{body:e,others:new Map}),J.get(i).others.set(t.id,t),n},be=(e,t,i)=>{!1===e.has(t)&&e.set(t,[]),e.get(t).push(i)},ve=(e,t,i)=>{var n,a,s,o,r,l;const{transform:d}=e;let c;const h=((e,t,i,n)=>{switch(t){case 0:return de.setValue(i[7],i[8],i[9]),new re.btBoxShape(de);case 2:if(void 0===n)throw Error(e+": vertices is undefined");{const e=new re.btTriangleMesh,t=!0;for(let i=0,a=n.length;i<a;i+=9)de.setValue(n[i+0],n[i+1],n[i+2]),ce.setValue(n[i+3],n[i+4],n[i+5]),he.setValue(n[i+6],n[i+7],n[i+8]),e.addTriangle(de,ce,he,!0);return new re.btBvhTriangleMeshShape(e,t)}case 1:return new re.btSphereShape(i[7]);default:throw Error("Shape not specified.")}})(e.name,e.shape,d,e.triangles);h.setMargin(0),!0===t&&(c=new re.btVector3(0,0,0),h.calculateLocalInertia(null!=(n=e.mass)?n:0,c)),de.setValue(d[0],d[1],d[2]),ge.setValue(d[3],d[4],d[5],d[6]),le.setOrigin(de),le.setRotation(ge);const g=new re.btDefaultMotionState(le),p=new re.btRigidBodyConstructionInfo(null!=(a=e.mass)?a:0,g,h,c),u=new re.btRigidBody(p);return u.type=e.type,u.trigger=!1,u.id=e.id,u.name=e.name,u.linkedRigidbodyId=e.linkedRigidbodyId,u.setRestitution(null!=(s=e.restitution)?s:0),u.setFriction(null!=(o=e.friction)?o:0),u.setDamping(null!=(r=e.linearDamping)?r:0,null!=(l=e.angularDamping)?l:0),void 0!==i&&u.setCollisionFlags(u.getCollisionFlags()|i),re.destroy(p),!0===t&&re.destroy(c),K.set(u.id,u),u},Me=(e,t,i=!1,n=0)=>{var a;ae=K.get(e),ae.activate(),!0===i&&(de.setValue(0,0,0),ae.setLinearVelocity(de),de.setValue(0,0,0),ae.setAngularVelocity(de)),de.setValue(t[n+0],t[n+1],t[n+2]),ge.setValue(t[n+3],t[n+4],t[n+5],t[n+6]),le.setOrigin(de),le.setRotation(ge),ae.setWorldTransform(le),2===ae.type&&(null==(a=ae.getMotionState())||a.setWorldTransform(le))},Se={async init(){re=await globalThis.Ammo(),le=new re.btTransform,de=new re.btVector3,ce=new re.btVector3,he=new re.btVector3,ge=new re.btQuaternion;const e=new re.btDefaultCollisionConfiguration,t=new re.btCollisionDispatcher(e),i=new re.btDbvtBroadphase,n=new re.btSequentialImpulseConstraintSolver;ie=new re.btDiscreteDynamicsWorld(t,i,n,e),ie.setGravity(new re.btVector3(0,-9.8,0))},update(e){var t;for(ae of(pe=performance.now(),we=(pe-ue)/1e3,ue=pe,ie.stepSimulation(we,40,.016666666666666666),ye=0,X))!1!==ae.isActive()&&(ne=ae.getMotionState(),ne.getWorldTransform(le),se=le.getOrigin(),oe=le.getRotation(),me=7*ye,e[me+0]=se.x(),e[me+1]=se.y(),e[me+2]=se.z(),e[me+3]=oe.x(),e[me+4]=oe.y(),e[me+5]=oe.z(),e[me+6]=oe.w(),void 0!==ae.linkedRigidbodyId&&(null==(t=K.get(ae.linkedRigidbodyId))||t.setMotionState(ne)),ye+=1);const i=[];return(e=>{ee.clear(),Z.clear(),J.clear();const t=ie.getDispatcher(),i=t.getNumManifolds();for(ye=0;ye<i;ye++){const i=t.getManifoldByIndexInternal(ye);if(0===i.getNumContacts())continue;const n=re.castObject(i.getBody0(),re.btRigidBody),a=re.castObject(i.getBody1(),re.btRigidBody);let s=!1;const o=4==(4&n.getCollisionFlags()),r=4==(4&a.getCollisionFlags());o||r?(s=fe(n,a),s&&!1===r&&(be(ee,n.id,a.id),!n.enter||a.name!==n.entity&&"any"!==n.entity||e.push([n.enter,n.id,a.id])),s=fe(a,n),s&&!1===o&&(be(ee,a.id,n.id),!a.enter||n.name!==a.entity&&"any"!==a.entity||e.push([a.enter,a.id,n.id]))):(s=fe(n,a),s&&be(Z,n.id,a.id),s=fe(a,n),s&&be(Z,a.id,n.id))}})(i),(e=>{te.clear(),$.clear();for(const[t,i]of _){const n=J.get(t),{body:a,others:s}=i;for(const[t,i]of s)void 0!==n&&!1!==n.others.has(t)||(s.delete(t),!0===a.trigger?(be(te,a.id,i.id),!a.leave||i.name!==a.entity&&"any"!==a.entity||e.push([a.leave,a.id,i.id])):!1===i.trigger&&be($,a.id,i.id));0===s.size&&_.delete(t)}})(i),{transforms:e,globalEvents:i,triggerEnter:[...ee],collisionStart:[...Z],triggerLeave:[...te],collisionEnd:[...$]}},applyCentralImpulse(e,t){ae=K.get(e),de.setValue(t.x,t.y,t.z),ae.applyCentralImpulse(de),ae.activate()},applyCentralForce(e,t){ae=K.get(e),de.setValue(t.x,t.y,t.z),ae.applyCentralForce(de),ae.activate()},teleport:Me,teleportMany(e,t,i=!1){ye=0;for(const n of e)Me(n,t,i,ye),ye+=7},createRigidbodies(e){let t,i,n;for(const a of e)switch(a.type){case 0:n=!1,t=1,i=ve(a,n,t),ie.addRigidBody(i,2,65533);break;case 1:n=0!==(a.mass||0),t=void 0,i=ve(a,n,t),X.add(i),ie.addRigidBody(i,1,65535);break;case 2:n=!1,t=2,i=ve(a,n,t),i.setActivationState(4),ie.addRigidBody(i)}},setGravity(e){de.setValue(e.x,e.y,e.z),ie.setGravity(de)}},xe=new Map,Be=new Set;let ze=new Float32Array(700),Re=0,je=0;const qe={bodyMap:xe,dynamicBodies:Be,init(){return Se.init()},update(){const e=Se.update(ze);for(const[t,i]of e.collisionStart)U("collisionstart",{id:t,others:i});ze=e.transforms,Re=0;for(const t of Be)je=7*Re,t.position.set(ze[je+0],ze[je+1],ze[je+2]),t.quaternion.set(ze[je+3],ze[je+4],ze[je+5],ze[je+6]),t.updateMatrix(),Re+=1},addRigidbodies(e,t){Re=0;for(const i of e){switch(xe.set(i.id,i),i.matrixAutoUpdate=!1,t[Re].type){case 1:Be.add(i)}Re+=1}Se.createRigidbodies(t)},applyCentralImpulse:Se.applyCentralImpulse,applyCentralForce:Se.applyCentralForce,teleport:Se.teleport,teleportMany:Se.teleportMany,setGravity:Se.setGravity},Le=(e,t)=>{const i=4*Math.random()-3,n=Math.random(),a=Math.random(),s=Math.random();return e.position.set(i,7,0),e.rotation.set(n,a,s),e.updateMatrix(),t[0]=i,t[1]=7,t[2]=0,t[3]=e.quaternion.x,t[4]=e.quaternion.y,t[5]=e.quaternion.z,t[6]=e.quaternion.w,t[7]=t[8]=t[9]=.25,t},Ve=(e,t=300)=>{let i;return function(...n){clearTimeout(i),i=setTimeout((()=>e.apply(this,n)),t)}},Ce=new e,Fe=new R,Ae=e=>new Promise((t=>{setTimeout(t,e)})),Oe=e=>{e instanceof j&&(e.castShadow=!0,e.receiveShadow=!0)},De=e=>{const t=e.getObjectByName("BoundingBox");t?(Fe.setFromObject(t),t.visible=!1):Fe.setFromObject(e),Fe.getSize(Ce)},Pe=e=>{e.traverse(Oe)},Te=e=>{const t=new Float32Array(7);Le(e,t),qe.teleport(e.id,t,!0),setTimeout(Te,12e3,e)};(async()=>{const t=document.querySelector("#canvas"),i=new A(t,innerWidth,innerHeight,devicePixelRatio),{scene:n,camera:a}=i;await Promise.all([i.init(),qe.init(),Y.load("name.glb")]),(async(e,t)=>{for((e=>{let t,i=e.length-1,n=0;for(;i>0;)n=Math.random()*(i+1)|0,t=e[i],e[i]=e[n],e[n]=t,i-=1})(e);e.length>0;){const{file:i,sel:n}=e.pop();await Y.load(i);const a=Y.get(i).scene,s=n?a.getObjectByName(n):a;Pe(s);const o=new Float32Array(10);Le(s,o),De(s),o[7]=Ce.x/2,o[8]=Ce.y/2,o[9]=Ce.z/2,qe.addRigidbodies([s],[{id:s.id,name:s.name,type:1,shape:0,transform:o,mass:1,linearDamping:0,angularDamping:0,friction:.3,restitution:.9}]),t.add(s),Te(s),await Ae(2e3)}})([{file:"portrait.glb",sel:"Portrait"},{file:"switch.glb"},{file:"synth.glb"},{file:"plant.glb"},{file:"lego.glb",sel:"Lego1"},{file:"lego.glb",sel:"Lego2"},{file:"lego.glb",sel:"Lego3"},{file:"lego.glb",sel:"Lego4"},{file:"lego.glb",sel:"Lego5"}],n);const s=Y.get("name.glb").scene;n.add(s);const o=s.getObjectByName("Light").children[0];o.castShadow=!0,o.shadow.bias=-.001;const r=s.getObjectByName("Micheal"),l=s.getObjectByName("Title");r.receiveShadow=!0,l.receiveShadow=!0;const d=new e,c=new R,h=new Float32Array(10);h[0]=r.position.x,h[1]=r.position.y,h[2]=r.position.z,h[3]=r.quaternion.x,h[4]=r.quaternion.y,h[5]=r.quaternion.z,h[6]=r.quaternion.w;const g=s.getObjectByName("BoundingBox1");c.setFromObject(g),g.visible=!1,c.getSize(d),h[7]=d.x/2,h[8]=d.y/2,h[9]=d.z/2;const p=new Float32Array(10);p[0]=l.position.x,p[1]=l.position.y,p[2]=l.position.z,p[3]=l.quaternion.x,p[4]=l.quaternion.y,p[5]=l.quaternion.z,p[6]=l.quaternion.w;const u=s.getObjectByName("BoundingBox2");c.setFromObject(u),u.visible=!1,c.getSize(d),p[7]=d.x/2,p[8]=d.y/2,p[9]=d.z/2,qe.addRigidbodies([r,l],[{id:r.id,name:r.name,type:0,shape:0,transform:h,friction:.3,restitution:.5},{id:l.id,name:l.name,type:0,shape:0,transform:p,friction:.3,restitution:.5}]);{const e=s.getObjectByName("Camera");a.position.copy(e.position),a.quaternion.copy(e.quaternion.multiply(e.children[0].quaternion))}d.set(0,-2,0),qe.setGravity(d);let w=!1;const y=()=>{i.setSize(t.clientWidth,t.clientHeight),innerWidth<600&&!1===w?(a.getWorldDirection(d),d.multiplyScalar(-5),a.position.add(d),w=!0):innerWidth>=600&&!0===w&&(a.getWorldDirection(d),d.multiplyScalar(5),a.position.add(d),w=!1)},m=new q;n.add(m),m.attach(a);const f=new L,b=new V,v=()=>{i.update(),a.lookAt(r.position),b.z=2*f.x/Math.PI/5,b.x=2*f.y/Math.PI/5,m.rotation.set(b.x,0,b.z),qe.update(),requestAnimationFrame(v)};y(),window.addEventListener("resize",Ve(y,400),F),window.addEventListener("mousemove",(e=>{f.x=+e.clientX/window.innerWidth*2-1,f.y=-e.clientY/window.innerHeight*2+1}),F),window.addEventListener("touchstart",(e=>{e.preventDefault()})),window.addEventListener("touchmove",(e=>{e.preventDefault(),f.x=+e.touches[0].clientX/window.innerWidth*2-1,f.y=-e.touches[0].clientY/window.innerHeight*2+1})),requestAnimationFrame(v)})();
